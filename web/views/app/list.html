{{define "content"}}
<ol class="breadcrumb mb-3" aria-label="breadcrumbs">
    <li class="breadcrumb-item"><a href="/">首页</a></li>
    <li class="breadcrumb-item active"><a href="/app/list">应用管理</a></li>
</ol>
<div class="page-title-box">
    <div class="row align-items-center">
        <div class="col-auto">
            <h2 class="page-title">
                应用列表
            </h2>
        </div>
        <div class="col-auto">
            <div class="text-muted text-h5 mt-2">总记录数:{{.Total}}</div>
        </div>
    </div>
</div>
<div id="app_list" class="row">
    <div class="col-12">
        <form class="mb-3">
            <div class="row">
                <div class="col-xl-6">
                    <div class="form-group row">
                        <label class="form-label col-3 col-form-label">分组：</label>
                        <div class="col">
                            <select id="group_id" name="group_id" class="form-select">
                                <option value="0">全部</option>
                                {{- range .GroupList}}
                                <option value="{{.ID}}" {{if eq $.GroupID .ID}}selected{{end}}>{{.Name}}</option>
                                {{- end}}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="form-group row">
                        <label class="form-label col-3 col-form-label">运行实例：</label>
                        <div class="col">
                            <select id="agent_id" name="agent_id" class="form-select">
                                <option value="0">全部</option>
                                {{- range .AgentList}}
                                <option value="{{.ID}}" {{if eq $.AgentID .ID}}selected{{end}}>
                                    {{.IP}}:{{.Port}}({{.Alias}})</option>
                                {{- end}}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="form-group row">
                        <label class="form-label col-3 col-form-label">名称：</label>
                        <div class="col">
                            <input type="text" id="name" name="name" class="form-control" placeholder=""
                                value="{{.Name}}">
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="form-group row">
                        <label class="form-label col-3 col-form-label">运行状态：</label>
                        <div class="col">
                            <select id="status" name="status" class="form-select">
                                <option value="-99">全部</option>
                                <option value="0">停止</option>
                                <option value="1">运行</option>
                                <option value="2">暂停</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="col btn-list">
                    <button type="submit" class="btn btn-primary ml-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-md">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        查询
                    </button>
                    <a href="/app/list" class="btn btn-info">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-md">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <polyline points="23 20 23 14 17 14"></polyline>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                        </svg>
                        重置
                    </a>
                    <a href="/app/add" class="btn btn-success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        新增应用
                    </a>
                </div>
            </div>
        </form>
        {{- range .List}}
        <div class="card mb-2">
            <div class="ribbon ribbon-left ribbon-bookmark bg-orange">
                <b>{{.ID}}</b>
            </div>
            <div class="card-header">
                <h3 class="card-title ml-6">
                    <span class="badge bg-teal">{{.GroupName}}</span>
                    <br/>
                    <span class="badge bg-lime">{{.AgentName}}</span>
                </h3>
                <h3 class="card-title ml-4">
                    {{.Name}}
                </h3>
                {{if eq .Status 0}}
                <span class="badge text-red bg-white">
                    <svg class="icon icon-lg" width="1em" height="1em" viewBox="0 0 20 20" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M13.596 10.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V6.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 010 1.393z">
                        </path>
                    </svg>
                </span>
                {{else if eq .Status 1}}
                <span class="badge text-green bg-white">
                    <svg class="icon icon-lg" width="1em" height="1em" viewBox="0 0 20 20" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M13.596 10.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V6.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 010 1.393z">
                        </path>
                    </svg>
                </span>
                {{else if eq .Status 2}}
                <span class="badge text-orange bg-white">
                    <svg class="icon icon-lg" width="1em" height="1em" viewBox="0 0 20 20" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M7.5 5.5A1.5 1.5 0 019 7v6a1.5 1.5 0 01-3 0V7a1.5 1.5 0 011.5-1.5zm5 0A1.5 1.5 0 0114 7v6a1.5 1.5 0 01-3 0V7a1.5 1.5 0 011.5-1.5z">
                        </path>
                    </svg>
                </span>
                {{else if eq .Status -1}}
                <span class="badge bg-red">deleted</span>
                {{end}}
                <div class="card-actions btn-list">
                    <a href="javascript:;" action="show" class="btn btn-secondary btn-icon ml-auto" title="查看配置详情">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                            viewbox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M12.442 12.442a1 1 0 011.415 0l3.85 3.85a1 1 0 01-1.414 1.415l-3.85-3.85a1 1 0 010-1.415z"
                                clip-rule="evenodd"></path>
                            <path fill-rule="evenodd"
                                d="M8.5 14a5.5 5.5 0 100-11 5.5 5.5 0 000 11zM15 8.5a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </a>
                    <a href="/app/edit?id={{.ID}}" class="btn btn-secondary btn-icon">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                            viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                            </path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                            </path>
                        </svg>
                    </a>
                    <a href="/app/monitor?id={{.ID}}" class="btn btn-secondary btn-icon">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                            viewbox="0 0 20 20" fill="currentColor">
                            <path d="M2 2h1v16H2V2zm1 15h15v1H3v-1z"></path>
                            <path fill-rule="evenodd"
                                d="M16.39 6.312l-4.349 5.437L9 8.707l-3.646 3.647-.708-.708L9 7.293l2.959 2.958 3.65-4.563.781.624z"
                                clip-rule="evenodd"></path>
                            <path fill-rule="evenodd"
                                d="M12 5.5a.5.5 0 01.5-.5h4a.5.5 0 01.5.5v4a.5.5 0 01-1 0V6h-3.5a.5.5 0 01-.5-.5z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </a>
                    <a href="/app/archive?id={{.ID}}" class="btn btn-secondary btn-icon">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                            viewbox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4 7v7.5c0 .864.642 1.5 1.357 1.5h9.286c.715 0 1.357-.636 1.357-1.5V7h1v7.5c0 1.345-1.021 2.5-2.357 2.5H5.357C4.021 17 3 15.845 3 14.5V7h1z"
                                clip-rule="evenodd"></path>
                            <path fill-rule="evenodd"
                                d="M7.5 9.5A.5.5 0 018 9h4a.5.5 0 010 1H8a.5.5 0 01-.5-.5zM17 4H3v2h14V4zM3 3a1 1 0 00-1 1v2a1 1 0 001 1h14a1 1 0 001-1V4a1 1 0 00-1-1H3z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </a>
                    {{if or (eq .Status 0) (eq .Status 2) }}
                    <a href="javascript:;" action="start" class="btn btn-success btn-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-md">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                    </a>
                    {{end}}
                    {{if eq .Status 1}}
                    <a href="javascript:;" action="restart" class="btn btn-success btn-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-md">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                    </a>
                    <a href="javascript:;" action="pause" class="btn btn-warning btn-icon">
                        <svg class="icon icon-md" width="1em" height="1em" viewBox="0 0 20 20" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M7.5 5.5A1.5 1.5 0 019 7v6a1.5 1.5 0 01-3 0V7a1.5 1.5 0 011.5-1.5zm5 0A1.5 1.5 0 0114 7v6a1.5 1.5 0 01-3 0V7a1.5 1.5 0 011.5-1.5z">
                            </path>
                        </svg>
                    </a>
                    {{end}}
                    {{if or (eq .Status 0) (eq .Status 2)}}
                    <a href="javascript:;" action="delete" class="btn btn-danger btn-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-md">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </a>
                    {{end}}
                </div>
            </div>
            <div class="card-body" style="display:none;">
                <dl class="row">
                    <dd class="col-12">
                        <span class="text-body text-h4">执行目录：</span>
                        <span class="text-muted">{{.Dir}}</span>
                    </dd>
                    <dd class="col-12">
                        <span class="text-body text-h4">执行命令：</span>
                        <span class="text-green">{{.Program}}</span>&nbsp;<span class="text-red">{{.Args}}</span>
                    </dd>
                    <dd class="col-12">
                        <span class="text-body text-h4">正常输出：</span>
                        <span class="text-muted">
                            <a href="/job/out_log?id={{.ID}}">{{.StdOut}}</a>
                        </span>
                    </dd>
                    <dd class="col-12">
                        <span class="text-body text-h4">错误输出：</span>
                        <span class="text-muted">
                            <a href="/job/out_log?id={{.ID}}">{{.StdErr}}</a>
                        </span>
                    </dd>
                </dl>
            </div>
        </div>
        {{end}}
    </div>
</div>
<div class="d-flex">
    {{.Pagination | unescaped}}
</div>
{{end}}
{{define "script"}}
<script type="text/javascript">
    $(document).ready(function () {
        $('#group_id').selectize({});
        $('#agent_id').selectize({});
        $('#status').selectize({});
        $("#app_list").delegate("a[action=show]", "click", function () {
            $(this).parent().parent().next().toggle();
        }).delegate("a[action=start]", "click", function () {
            var id = $(this).parent().attr("data-bind");
            $.getJSON("/app/start?id=" + id, function (data) {
                if (data.code == 200) {
                    alert("操作成功");
                    window.location.reload(true)
                } else {
                    alert(data.message);
                }
            })
        }).delegate("a[action=restart]", "click", function () {
            var id = $(this).parent().attr("data-bind");
            $.getJSON("/app/restart?id=" + id, function (data) {
                if (data.code == 200) {
                    alert("操作成功");
                    window.location.reload(true)
                } else {
                    alert(data.message);
                }
            })
        }).delegate("a[action=pause]", "click", function () {
            var id = $(this).parent().attr("data-bind");
            $.getJSON("/app/pause?id=" + id, function (data) {
                if (data.code == 200) {
                    alert("操作成功");
                    window.location.reload(true)
                } else {
                    alert(data.message);
                }
            })
        }).delegate("a[action=delete]", "click", function () {
            var id = $(this).parent().attr("data-bind");
            $.getJSON("/app/delete?id=" + id, function (data) {
                if (data.code == 200) {
                    alert("操作成功");
                    window.location.reload(true)
                } else {
                    alert(data.message);
                }
            })
        });
    });
</script>
{{end}}